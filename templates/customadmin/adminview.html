{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Order Management</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}"> <!-- Custom CSS -->
	<style>

		body, h1, h2, h3, p {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		/* Sidebar Styling */
		.sidebar {
			height: 100vh;
			background: #343a40;
			color: #fff;
			position: fixed;
			top: 0;
			left: 0;
			width: 250px;
			transition: all 0.3s;
			z-index: 1000;
		}
		.sidebar .nav-link {
			color: #fff;
			padding: 15px 20px;
			display: block;
			transition: background 0.3s;
		}
		.sidebar .nav-link:hover {
			background: #495057;
			text-decoration: none;
		}
		.sidebar .nav-logo {
			font-size: 24px;
			padding: 20px;
			text-align: center;
			border-bottom: 1px solid #495057;
		}
		
		/* Content Styling */
		.content {
			margin-left: 270px;
			padding: 20px;
			width: calc(100% - 270px);
		}
		
		/* Navbar Styling */
		.custom-navbar {
			width: calc(100% - 270px);
			margin-left: 270px;
			padding: 15px;
			background-color: #343a40;
			box-shadow: 0px 4px 2px -2px gray;
		}
		
		/* Order Details Styling */
		.order-details {
			background: #f9f9f9;
			padding: 20px;
			margin-top: 15px;
			border-radius: 5px;
			box-shadow: 0px 4px 2px -2px gray;
			width: 45%; /* Adjusted to fit side-by-side */
			display: inline-block; /* To allow side-by-side display */
			vertical-align: top;
		}
		
		.order-details h3 {
			margin-bottom: 15px;
		}
		
		.order-details p {
			margin: 5px 0;
		}
		
		/* Table Styling */
		.table-wrapper {
			margin-top: 20px;
		}
		
		.table-title {
			background: #4CAF50;
			padding: 15px;
			color: white;
			border-radius: 5px 5px 0 0;
		}
		
		.table-title h2 {
			margin: 0;
		}
		
		table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 15px;
		}
		
		table th, table td {
			padding: 12px;
			text-align: left;
			border-bottom: 1px solid #ddd;
		}
		
		table th {
			background-color: #4CAF50;
			color: white;
			font-weight: bold;
			text-transform: uppercase;
		}
		
		table tbody tr:nth-child(even) {
			background-color: #f9f9f9;
		}
		
		table tbody tr:hover {
			background-color: #f1f1f1;
		}
		
		.btn {
			margin-top: 15px;
		}
		table img {
			width: 100px; /* Set a fixed width */
			height: 100px; /* Set a fixed height */
			object-fit: cover; /* Ensures the image covers the area without stretching */
		}

	</style>
</head>
<body>
    <div class="sidebar">
        <div class="nav-logo">
            <i class='bx bx-layer'></i> Shop
        </div>
        <nav class="nav flex-column">
            <a href="{% url 'adminside:dashboard' %}" class="nav-link active"><i class='bx bx-grid-alt'></i> Dashboard</a>
            <a href="{% url 'salesreport:salesReport' %}" class="nav-link sales-link"><i class='bx bx-line-chart'></i> Sales</a>

            <a href="{% url 'usermanagement:usermanagement' %}" class="nav-link"><i class='bx bx-user'></i> Users</a>
            <a href="{% url 'products:products' %}" class="nav-link"><i class='bx bx-message-square-detail'></i> Products</a>
            <a href="{% url 'category:categorymanagement' %}" class="nav-link"><i class='bx bx-bookmark'></i> Categories</a>
            <a href="{% url 'ordermanagement:order_management' %}" class="nav-link"><i class='bx bx-cart'></i> Orders</a>
            <a href="{% url 'offermanagement:offermanagement' %}" class="nav-link"><i class='bx bx-gift'></i> Offers</a>
            <a href="{% url 'couponmanagement:coupon' %}" class="nav-link {% if request.resolver_match.url_name == 'coupon' %}active{% endif %}"><i class='bx bx-tag'></i> Coupons</a>
            <a href="{% url 'adminside:logout_view' %}" class="nav-link"><i class='bx bx-log-out'></i> Logout</a>
        </nav>
    </div>

    <div class="content">
        <!-- Navbar -->
        <nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark">
        </nav>
		<div style="display:flex; justify-content:space-around">
        <!-- Address and Order Details -->
        <div class="order-details">
            <h3>Order Details</h3>
           
            <p><strong>Order Date:</strong> {{ all_order.order_date }}</p>
            <p><strong>Payment Method:</strong> {{ all_order.payment_method }}</p>
        </div>
		<div class="order-details " style="margin-right:200px%">
            <h3>Address Details</h3>
            <p><strong>Name:</strong> {{ first_address.address_name }}</p>
            <p><strong>Email:</strong> {{ first_address.address_Email }}</p>
            <p><strong>Phone:</strong> {{ first_address.address_phone }}</p>

            <p><strong>Adrees:</strong> {{ first_address.Address }}</p>
            <p><strong>Landmark:</strong> {{ first_address.landmark }}</p>
            <p><strong>City:</strong> {{ first_address.city }}</p>
            <p><strong>district:</strong> {{ first_address.district }}</p>
            <p><strong>state:</strong> {{ first_address.state }}</p>

            <p><strong>Payment Method:</strong> {{ first_address.pin }}</p>
            
        </div>
	</div>
        <!-- Order Table -->
        <div class="container-fluid order-table">
            <div class="table-wrapper">
                <div class="table-title">
                    <div class="row">
                        <div class="col-sm-6">
                            <h2>Manage Orders</h2>
                        </div>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Product Name</th>
                            <th>Image</th>
                            <th>Amount</th>
                            <th>Details</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                         {% for i in order_item %}
                        <tr>
                            <td>{{ forloop.counter }} </td>
                            <td>{{ i.product.name }} </td>

                            <td><img src="{{i.product.image1.url}}" alt=""></td>
                            <td>â‚¹{{ total_amounts|slice:forloop.counter|last|floatformat:2 }}</td>
                          
                            <td><a >View {{i.id}}{{all_order.id}}</a></td>
                            <td>
								{% if i.status == 'Cancelled' %}
									<h3 style="color:red;">Order Cancelled<h3>
									{% elif i.status == 'Returned' %}
										<h3 style="color:red;">Order Returned<h3>
									{% else %}
								<form action="{% url 'ordermanagement:status_update' %}" method="post" id="statusForm{{ forloop.counter }}">
									{% csrf_token %}
									<input type="hidden" name="item_id" value="{{ i.id }}">
									<input type="hidden" name="ord_id" value="{{ all_order.id }}">
									
									
									<select name="status" onchange="statusUpdate({{ forloop.counter }})">
										<option value="placed" {% if i.status == 'placed' %}selected{% endif %}>Placed</option>
										<option value="Shipped" {% if i.status == 'Shipped' %}selected{% endif %}>Shipped</option>
										<option value="Out For Delivery" {% if i.status == 'Out For Delivery' %}selected{% endif %}>Out For Delivery</option>
										<option value="Delivered" {% if i.status == 'Delivered' %}selected{% endif %}>Delivered</option>
									</select>
									
								</form>
								{% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <a href="{% url 'adminside:dashboard' %}" class="btn btn-danger"><span>Back to Admin Home</span></a>
            </div>
        </div>
    </div>

	<script>
		function statusUpdate(formIndex) {
			const form = document.getElementById('statusForm' + formIndex);
			form.submit();
		}
		</script>
</body>
</html>
